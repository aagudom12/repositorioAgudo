<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${noticia.titulo}">Detalle Noticia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<div class="container mt-4">
    <h2 th:text="${noticia.titulo}">Título</h2>
    <p th:text="${noticia.contenido}">Contenido</p>
    <div th:if="${noticia.fotos != null and !noticia.fotos.isEmpty()}">
        <h4>Fotos</h4>
        <div>
            <img th:each="foto : ${noticia.fotos}"
                 th:src="@{${foto.url}}"
                 alt="Foto de la noticia"
                 style="max-width: 100%; height: auto; margin-bottom: 10px;">
        </div>
    </div>

    <p><strong>Publicado:</strong> <span th:text="${#temporals.format(noticia.fechaPublicacion, 'dd/MM/yyyy HH:mm')}"></span></p>

    <hr/>
    <h4>Comentarios</h4>

    <div th:each="comentario : ${comentarios}">
        <p><strong th:text="${comentario.usuario.nombre}">Usuario</strong>: <span th:text="${comentario.contenido}"></span></p>

        <!-- Mostrar solo si el comentario es del usuario actual -->
        <div th:if="${#authentication.name == comentario.usuario.email}">
            <a th:href="@{'/comentario/editar/' + ${comentario.id}}" class="btn btn-sm btn-warning">Editar</a>
        </div>

        <!-- Mostrar si el usuario es el propietario del comentario o un admin -->
        <div th:if="${#authentication.name == comentario.usuario.email or #authorization.expression('hasRole(''ADMIN'')')}">
            <form th:action="@{'/comentario/eliminar/' + ${comentario.id}}" method="post"
                  onsubmit="return confirm('¿Estás seguro de que deseas eliminar este comentario?');"
                  style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
            </form>
        </div>

        <!-- Botón de like -->
        <form th:action="@{'/comentario/' + ${comentario.id} + '/like'}" method="post" style="display:inline;">
            <button type="submit"style="background:none; border:none; cursor:pointer;">
                <i class="fa-heart"
                   th:classappend="${comentario.usuarioLeDioLike} ? 'fas text-danger' : 'far text-muted'"></i>
                <span th:text="${comentario.numeroLikes}">0</span>
            </button>
        </form>

        <small th:text="${#temporals.format(comentario.fechaComentario, 'dd/MM/yyyy HH:mm')}"></small>
        <hr/>
    </div>

    <th:block sec:authorize="isAuthenticated()">
        <form th:action="@{'/noticia/' + ${noticia.id} + '/comentario'}" method="post">
            <textarea name="texto" class="form-control" required></textarea>
            <button type="submit" class="btn btn-primary mt-2">Comentar</button>
        </form>
    </th:block>

    <a th:href="@{/inicio}" class="btn btn-secondary">Volver al inicio</a>
</div>
</body>
</html>
